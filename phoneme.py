VOCALS = ['a', 'i', 'u', 'e', 'o', 'e\'', 'ai', 'au', 'oi']

# List of phonemes that exist in the Malay language, categorized by their first characters
malay_phonemes = {
    'a': ['ai', 'au', 'a'],
    'b': ['b'],
    'c': ['c'],
    'd': ['d'],
    'e': ['e\'', 'e'],
    'g': ['g'],
    'h': ['h'],
    'i': ['i'],
    'j': ['j'],
    'k': ['k'],
    'l': ['l'],
    'm': ['m'],
    'n': ['ny', 'ng', 'n'],
    'o': ['oi', 'o'],
    'p': ['p'],
    'r': ['r'],
    's': ['s'],
    't': ['t'],
    'u': ['u'],
    'w': ['w'],
    'y': ['y'],
}

durations = {
    "a": { 'Di':  80, 'Dmin': 12, 'Dmax': 848 },
    "b": { 'Di':  60, 'Dmin': 4, 'Dmax': 551 },
    "c": { 'Di':  70, 'Dmin': 10, 'Dmax': 822 },
    "d": { 'Di':  65, 'Dmin': 7, 'Dmax': 922 },
    "e": { 'Di':  79, 'Dmin': 8, 'Dmax': 452 },
    "f": { 'Di':  87, 'Dmin': 87, 'Dmax': 87 },
    "g": { 'Di':  63, 'Dmin': 11, 'Dmax': 180 },
    "h": { 'Di':  86, 'Dmin': 8, 'Dmax': 598 },
    "i": { 'Di':  94, 'Dmin': 8, 'Dmax': 580 },
    "j": { 'Di':  63, 'Dmin': 13, 'Dmax': 250 },
    "k": { 'Di':  70, 'Dmin': 10, 'Dmax': 593 },
    "l": { 'Di':  60, 'Dmin': 8, 'Dmax': 761 },
    "m": { 'Di':  81, 'Dmin': 10, 'Dmax': 808 },
    "n": { 'Di':  86, 'Dmin': 9, 'Dmax': 1234 },
    "o": { 'Di':  83, 'Dmin': 15, 'Dmax': 938 },
    "p": { 'Di':  65, 'Dmin': 5, 'Dmax': 569 },
    "r": { 'Di':  67, 'Dmin': 3, 'Dmax': 365 },
    "s": { 'Di':  97, 'Dmin': 20, 'Dmax': 677 },
    "t": { 'Di':  62, 'Dmin': 4, 'Dmax': 719 },
    "u": { 'Di':  105, 'Dmin': 8, 'Dmax': 586 },
    "v": { 'Di':  37, 'Dmin': 29, 'Dmax': 43 },
    "w": { 'Di':  59, 'Dmin': 17, 'Dmax': 146 },
    "y": { 'Di':  71, 'Dmin': 20, 'Dmax': 293 },
    "ai": { 'Di':  129, 'Dmin': 25, 'Dmax': 320 },
    "au": { 'Di':  195, 'Dmin': 41, 'Dmax': 500 },
    "oi": { 'Di':  374, 'Dmin': 121, 'Dmax': 788 },
    "ng": { 'Di':  100, 'Dmin': 13, 'Dmax': 470 },
    "ny": { 'Di':  90, 'Dmin': 30, 'Dmax': 154 },
    "e'": { 'Di':  96, 'Dmin': 4, 'Dmax': 729 },
}

duration_constants = {
    'a': {'V1': 1.65108582352941, 'V2': 1.23462155228758, 'V3': 1.61421809348739    , 'V4': 1.04585942906574, 'V5': 0   , 'V6': 0.914846323529408    , 'V7': 0 },
    'b': {'K1': 0               , 'K2': 1.08408023809524, 'K3': 0.831171130952379   , 'K4': 0               , 'K5': 0   , 'K6': 1.02400178571429     , 'K7': 1.15043392857143 },
    'c': {'K1': 0               , 'K2': 0.580361249999998, 'K3': 0                  , 'K4': 0               , 'K5': 0   , 'K6': 0                    , 'K7': 0 },
    'd': {'K1': 0               , 'K2': 0.922093049568966, 'K3': 0.815917672413794  , 'K4': 0               , 'K5': 0   , 'K6': 0                    , 'K7': 0 },
    'e': {'V1': 0               , 'V2': 1.25078004694836, 'V3': 1.53104883649725    , 'V4': 1.05147716297787, 'V5': 0   , 'V6': 0                    , 'V7': 0 },
    'g': {'K1': 0, 'K2': 1.10334134615384, 'K3': 0.819666239316238, 'K4': 0, 'K5': 0, 'K6': 0, 'K7': 0, 'K8': 0, 'K9': 0, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
    'h': {'K1': 0, 'K2': 0.188522435897437, 'K3': 0.553399038461536, 'K4': 0.793473776223778, 'K5': 0, 'K6': 0, 'K7': 0, 'K8': 0, 'K9': 0.337491025641022, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
    'i': {'V1': 1.13581813953488, 'V2': 0, 'V3': 1.16954721471065, 'V4': 0.572750813953489, 'V5': 0, 'V6': 0.616134883720928, 'V7': 0, 'V8': 0, 'V9': 0.358033720930237, 'V10': 0, 'V11': 0, 'V12': 0, 'V13': 0, 'V14': 0, 'V15': 0, 'V16': 0, 'V17': 0},
    'j': {'K1': 0, 'K2': 1.77114285714285, 'K3': 0.881812545454546, 'K4': 0, 'K5': 0, 'K6': 0, 'K7': 0, 'K8': 0, 'K9': 0, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
    'k': {'K1': 0.704045, 'K2': 0.835971296296297, 'K3': 0.679087142857144, 'K4': 0.623823154761906, 'K5': 0, 'K6': 0, 'K7': 0, 'K8': 0, 'K9': 0.774708333333341, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 1.14232833333334},
    'l': {'K1': 0.989933333333334, 'K2': 0.993945118343196, 'K3': 0.685394493006995, 'K4': 3.26900851648352, 'K5': 0, 'K6': 0, 'K7': 0, 'K8': 0.361626442307701, 'K9': 0, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
    'm': {'K1': 1.49705985915493, 'K2': 0.886131161971831, 'K3': 1.25575258215963, 'K4': 1.68414849094567, 'K5': 0.340518309859155, 'K6': 0, 'K7': 0, 'K8': 0, 'K9': 0, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
    'n': {'K1': 0.935213564213565, 'K2': 0.771304195804196, 'K3': 0.582093766233768, 'K4': 1.34483791208791, 'K5': 0, 'K6': 0, 'K7': 0, 'K8': 0, 'K9': 1.0506564935065, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
    'o': {'V1': 1.41201176470588, 'V2': 0, 'V3': 1.03960053475936, 'V4': 1.06103174740484, 'V5': 0, 'V6': 0.239888970588231, 'V7': 0, 'V8': 0, 'V9': 0, 'V10': 0, 'V11': 0, 'V12': 0, 'V13': 0, 'V14': 0, 'V15': 0, 'V16': 0, 'V17': 0},
    'p': {'K1': 0.742289722222222, 'K2': 0.809367647058821, 'K3': 0.427750416666666, 'K4': 0.916666666666667, 'K5': 0, 'K6': 0, 'K7': 0.570116666666655, 'K8': 0, 'K9': 0, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
    'r': {'K1': 0, 'K2': 0.9254494140625, 'K3': 0.703873918269231, 'K4': 1.265565625, 'K5': 0, 'K6': 0, 'K7': 0, 'K8': 0.415153125, 'K9': 0.971160937499995, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0.585209375000008, 'K17': 0},
    's': {'K1': 0, 'K2': 0.947847835497835, 'K3': 0.844397835497836, 'K4': 1.12484123376623, 'K5': 0, 'K6': 0, 'K7': 0.755651948051943, 'K8': 0, 'K9': 0, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
    't': {'K1': 0, 'K2': 0.598441487068965, 'K3': 0.556199455535391, 'K4': 1.31654956896551, 'K5': 0, 'K6': 0, 'K7': 0.833853448275858, 'K8': 0.805813793103455, 'K9': 0, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0.552272413793103, 'K16': 0, 'K17': 0},
    'u': {'V1': 0.87745206185567, 'V2': 0, 'V3': 0.780558307360346, 'V4': 0.82127319587629, 'V5': 0, 'V6': 0, 'V7': 0, 'V8': 0, 'V9': 0, 'V10': 0, 'V11': 0, 'V12': 0, 'V13': 0, 'V14': 0, 'V15': 0, 'V16': 0, 'V17': 0},
    'w': {'K1': 0, 'K2': 0, 'K3': 1.1002373015873, 'K4': 0, 'K5': 0, 'K6': 0, 'K7': 0, 'K8': 0, 'K9': 0, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
    'y': {'K1': 0, 'K2': 0, 'K3': 1.45656666666667, 'K4': 0, 'K5': 0, 'K6': 0, 'K7': 0, 'K8': 0, 'K9': 0, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
    'e\'': {'V1': 1.63461798418972, 'V2': 0, 'V3': 1.20920338791643, 'V4': 0.743290942028983, 'V5': 0.202236956521739, 'V6': 0.872659782608695, 'V7': 0, 'V8': 0, 'V9': 0, 'V10': 0, 'V11': 0, 'V12': 0, 'V13': 0, 'V14': 0, 'V15': 0, 'V16': 0, 'V17': 0},
    'ai': {'V1': 0, 'V2': 0, 'V3': 1.11118956043956, 'V4': 0, 'V5': 0, 'V6': 0, 'V7': 0, 'V8': 0, 'V9': 0, 'V10': 0, 'V11': 0, 'V12': 0, 'V13': 0, 'V14': 0, 'V15': 0, 'V16': 0, 'V17': 0},
    'au': {'V1': 0, 'V2': 0, 'V3': 0.360161038961037, 'V4': 0, 'V5': 0, 'V6': 0, 'V7': 0, 'V8': 0, 'V9': 0, 'V10': 0, 'V11': 0, 'V12': 0, 'V13': 0, 'V14': 0, 'V15': 0, 'V16': 0, 'V17': 0},
    'oi': {'V1': 0, 'V2': 0, 'V3': 0, 'V4': 0, 'V5': 0, 'V6': 0, 'V7': 0, 'V8': 0, 'V9': 0, 'V10': 0, 'V11': 0, 'V12': 0, 'V13': 0, 'V14': 0, 'V15': 0, 'V16': 0, 'V17': 0},
    'ny': {'K1': 0, 'K2': 0.32444, 'K3': 0.607055000000005, 'K4': 0, 'K5': 0, 'K6': 0, 'K7': 0, 'K8': 0, 'K9': 0, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
    'ng': {'K1': 0, 'K2': 0.66683275862069, 'K3': 0.454482758620695, 'K4': 1.07206951724138, 'K5': 0, 'K6': 0, 'K7': 0, 'K8': 0, 'K9': 0, 'K10': 0, 'K11': 0, 'K12': 0, 'K13': 0, 'K14': 0, 'K15': 0, 'K16': 0, 'K17': 0},
}

malay_phoneme_types = {
    "V" : ["V1"],
    "VK" : ["V2", "K1"],
    "KV" : ["K2", "V3"],
    "KVK" : ["K3", "V4", "K4"],
    "KKV" : ["K5", "K6", "V5"],
    "KKVK" : ["K7", "K8", "V6", "K9"],
    "VKK" : ["V7", "K10", "K11"],
    "KVKK" : ["K12", "V8", "K13", "K14"],
    "KKVKK" : ["K15", "K16", "V9", "K17", "K18"],
    "KKKV" : ["K19", "K20", "K21", "V10"],
    "KKKVK" : ["K22", "K23", "K24", "V11", "K25"],
}

sampa_codes = {
    'p': 'p',
    'b': 'b',
    't': 't',
    'd': 'd',
    'k': 'k',
    'g': 'g',
    'c': 'tS',
    'j': 'dZ',
    'f': 'f',
    's': 's',
    'z': 'z',
    'h': 'h',
    'm': 'm',
    'n': 'n',
    'ng': 'N',
    'r': 'r',
    'l': 'l',
    'w': 'w',
    'y': 'j',
    'ny': 'nY',
    'a': 'V',
    'e\'': '@',
    'e': 'e',
    'i': 'I',
    'o': 'Q',
    'u': 'U',
    'ai': 'aI',
    'oi': 'OI',
    'au': 'aU'
}

def syllable_to_phonemes(syllable):
    phonemes = []

    pos = 0
    while (pos < len(syllable)):
        possible_phonemes = malay_phonemes[syllable[pos]]

        skip = 1
        for phoneme in possible_phonemes:
            if pos + len(phoneme) > len(syllable):
                continue

            if syllable[pos:pos+len(phoneme)] == phoneme:
                phonemes.append(phoneme)
                skip = len(phoneme)
                break

        pos += skip
    return phonemes

def phoneme_to_code(phoneme):
    if phoneme in VOCALS:
        return 'V'
    else:
        return 'K'

def get_phoneme_type(phonemes):
    phoneme_type = "".join([phoneme_to_code(phoneme) for phoneme in phonemes])
    return malay_phoneme_types[phoneme_type]